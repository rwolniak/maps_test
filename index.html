<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyA8GdfZRp_Cs7M1eJqaAUiobusR3kC2H30&libraries=places&sensor=true">
    </script>
    <script type="text/javascript">
  var initialLocation;
  var siberia = new google.maps.LatLng(60, 105);
  var newyork = new google.maps.LatLng(40.69847032728747, -73.9514422416687);
  var browserSupportFlag =  new Boolean();
  var service;
  var resultList;

    function initialize() {
      var mapOptions = {
        zoom: 14
      };
      var map = new google.maps.Map(document.getElementById("map-canvas"),
          mapOptions);
   // Try W3C Geolocation (Preferred)
  if(navigator.geolocation) {
    browserSupportFlag = true;
    navigator.geolocation.getCurrentPosition(function(position) {
      initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
      var request = {
        location: initialLocation,
        radius: '10000',
        types: ['liquor_store']
      };
      
      map.setCenter(initialLocation);

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, function(results, status, pagination) {
      if (status != google.maps.places.PlacesServiceStatus.OK) {
        return;
      }
      resultList.addPlaces(results);
      if (pagination.hasNextPage) {
        resultList.button.onClick = pagination.nextPage;
      }
  });

    }, function() {
      handleNoGeolocation(browserSupportFlag);
    });
  }
  // Browser doesn't support Geolocation
  else {
    browserSupportFlag = false;
    handleNoGeolocation(browserSupportFlag);
  }

  function handleNoGeolocation(errorFlag) {
    if (errorFlag == true) {
      alert("Geolocation service failed. Please try again.");
      initialLocation = newyork;
    } else {
      alert("Please enable location services to help us find you your favorite brews. Sincerely, Brewze.");
      initialLocation = siberia;
    }
    map.setCenter(initialLocation);
  }
      }
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"/>
  </body>
</html>
